webpackJsonp([20],{176:function(t,e){t.exports=function(t,e,n,i,r){var o,s=t=t||{},a=typeof t.default;"object"!==a&&"function"!==a||(o=t,s=t.default);var l="function"==typeof s?s.options:s;e&&(l.render=e.render,l.staticRenderFns=e.staticRenderFns),i&&(l._scopeId=i);var u;if(r?(u=function(t){t=t||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext,t||"undefined"==typeof __VUE_SSR_CONTEXT__||(t=__VUE_SSR_CONTEXT__),n&&n.call(this,t),t&&t._registeredComponents&&t._registeredComponents.add(r)},l._ssrRegister=u):n&&(u=n),u){var c=l.functional,p=c?l.render:l.beforeCreate;c?l.render=function(t,e){return u.call(e),p(t,e)}:l.beforeCreate=p?[].concat(p,u):[u]}return{esModule:o,exports:s,options:l}}},177:function(t,e,n){var i=n(176)(n(184),null,null,null,null);t.exports=i.exports},178:function(t,e,n){var i=n(176)(n(185),null,null,null,null);t.exports=i.exports},179:function(t,e,n){var i=n(176)(n(182),null,null,null,null);t.exports=i.exports},180:function(t,e,n){var i=n(176)(n(183),null,null,null,null);t.exports=i.exports},182:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(t){return n.e(93).then(function(){var e=[n(200)];t.apply(null,e)}.bind(this)).catch(n.oe)};e.default={Content:i}},183:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(t){return n.e(10).then(function(){var e=[n(197)];t.apply(null,e)}.bind(this)).catch(n.oe)},r=function(t){return n.e(78).then(function(){var e=[n(201)];t.apply(null,e)}.bind(this)).catch(n.oe)},o=function(t){return n.e(6).then(function(){var e=[n(198)];t.apply(null,e)}.bind(this)).catch(n.oe)},s=function(t){return n.e(8).then(function(){var e=[n(199)];t.apply(null,e)}.bind(this)).catch(n.oe)},a=function(t){return n.e(84).then(function(){var e=[n(202)];t.apply(null,e)}.bind(this)).catch(n.oe)};e.default={Header:i,SecondHeader:r,HeaderLink:o,HeaderTitle:s,SimpleHeader:a,Title:s}},184:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(t){return n.e(91).then(function(){var e=[n(203)];t.apply(null,e)}.bind(this)).catch(n.oe)};e.default={Icon:i}},185:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(t){return n.e(77).then(function(){var e=[n(205)];t.apply(null,e)}.bind(this)).catch(n.oe)},r=function(t){return n.e(95).then(function(){var e=[n(206)];t.apply(null,e)}.bind(this)).catch(n.oe)},o=function(t){return n.e(70).then(function(){var e=[n(204)];t.apply(null,e)}.bind(this)).catch(n.oe)};e.default={Button:i,CDButton:r,ButtonGroup:o}},186:function(t,e,n){var i=n(176)(n(188),null,null,null,null);t.exports=i.exports},187:function(t,e,n){var i=n(176)(n(189),null,null,null,null);t.exports=i.exports},188:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(t){return n.e(79).then(function(){var e=[n(207)];t.apply(null,e)}.bind(this)).catch(n.oe)};e.default={Posts:i}},189:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(t){return n.e(76).then(function(){var e=[n(210)];t.apply(null,e)}.bind(this)).catch(n.oe)},r=function(t){return n.e(89).then(function(){var e=[n(209)];t.apply(null,e)}.bind(this)).catch(n.oe)},o=function(t){return n.e(90).then(function(){var e=[n(208)];t.apply(null,e)}.bind(this)).catch(n.oe)};e.default={List:i,ListItem:r,ListInput:o}},190:function(t,e,n){var i=n(176)(n(191),null,null,null,null);t.exports=i.exports},191:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(t){return n.e(80).then(function(){var e=[n(213)];t.apply(null,e)}.bind(this)).catch(n.oe)},r=function(t){return n.e(81).then(function(){var e=[n(215)];t.apply(null,e)}.bind(this)).catch(n.oe)},o=function(t){return n.e(96).then(function(){var e=[n(214)];t.apply(null,e)}.bind(this)).catch(n.oe)};e.default={Footer:i,SecondFooter:r,FooterItem:o,Item:o}},192:function(t,e,n){var i=n(176)(n(193),null,null,null,null);t.exports=i.exports},193:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(t){return n.e(7).then(function(){var e=[n(211)];t.apply(null,e)}.bind(this)).catch(n.oe)},r=function(t){return n.e(9).then(function(){var e=[n(212)];t.apply(null,e)}.bind(this)).catch(n.oe)},o=function(t){return n.e(94).then(function(){var e=[n(216)];t.apply(null,e)}.bind(this)).catch(n.oe)};e.default={Column:i,ColumnItem:r,ColumnSort:o}},217:function(t,e,n){var i=n(176)(n(218),null,null,null,null);t.exports=i.exports},218:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(t){return n.e(71).then(function(){var e=[n(228)];t.apply(null,e)}.bind(this)).catch(n.oe)};e.default={Paginate:i}},223:function(t,e,n){var i=n(176)(n(225),null,null,null,null);t.exports=i.exports},224:function(t,e,n){var i=n(176)(n(226),null,null,null,null);t.exports=i.exports},225:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(t){return n.e(62).then(function(){var e=[n(240)];t.apply(null,e)}.bind(this)).catch(n.oe)};e.default={Datetimer:i}},226:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(t){return n.e(66).then(function(){var e=[n(241)];t.apply(null,e)}.bind(this)).catch(n.oe)};e.default={Popup:i}},419:function(t,e,n){var i=n(176)(n(752),n(454),null,null,null);t.exports=i.exports},454:function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"page"},[n("page-header",{slot:"header"},[n("header-title",[t._v(t._s(t.$t("admin.salerecord.title")))]),t._v(" "),n("header-link",{attrs:{isback:!0,left:!0}},[n("icon",{staticClass:"font08",attrs:{icon:"arrowleft"}}),t._v(t._s(t.$t("default.back")))],1),t._v(" "),n("header-link",{on:{linkClick:function(e){t.searchshow=!0}}},[n("icon",{staticClass:"font08",attrs:{icon:"search"}})],1)],1),t._v(" "),n("page-content",{attrs:{ispadding:!0}},[n("list",{attrs:{linktitle:!0}},[n("column-sort",{attrs:{sortdata:[{text:"时间",num:"25",key:"nUpdateTime",index:2},{text:"门店",num:"15",key:"oShopID"},{text:"会员",num:"20",key:"oMemberID"},{text:"数量",num:"10",key:"dTotleNumber"},{text:"总售价",num:"10",key:"dTotleSalePrice"},{text:"实收",num:"10",key:"dPaidMoney"},{text:"盈利",num:"10",key:"dProfitMoney"}]},on:{sortchange:t.sortchange},slot:"title"}),t._v(" "),t._l(t.pageDataList,function(e,i){return n("list-item",{key:i,attrs:{link:!0}},[n("router-link",{staticClass:"item-content",attrs:{to:{path:"admin_sale_record_single",query:{id:e.id}},tag:"div"}},[n("column",[n("column-item",{attrs:{num:"25"}},[t._v("\n                    "+t._s(t._f("from")(e.nAddTime))+"\n                  ")]),t._v(" "),n("column-item",{attrs:{num:"15"}},[t._v("\n                    "+t._s(e.sShopName)+"\n                  ")]),t._v(" "),n("column-item",{attrs:{num:"20"}},[t._v("\n                    "+t._s(e.sSerial)+" "),n("font",{directives:[{name:"show",rawName:"v-show",value:e.sTag&&e.sTag.length>0,expression:"p.sTag && p.sTag.length>0"}],staticClass:"color-primary font07"},[t._v("("+t._s(e.sTag)+")")])],1),t._v(" "),n("column-item",{staticClass:"text-right",attrs:{num:"10"}},[t._v("\n                    "+t._s(e.dTotleNumber>0?"+":"")+t._s(t._f("decimal")(e.dTotleNumber))+"\n                    "),e.nType?n("span",[n("icon",{attrs:{icon:t.$t("default.saleicons")[e.nType]}})],1):t._e()]),t._v(" "),n("column-item",{staticClass:"text-right",attrs:{num:"10"}},[n("font",{staticClass:"font07"},[t._v(t._s(t._f("decimal")(e.dTotleSalePrice)))])],1),t._v(" "),n("column-item",{staticClass:"text-right",attrs:{num:"10"}},[t._v("\n                    "+t._s(e.dPaidMoney>0?"+":"")),n("font",{staticClass:"font07"},[t._v(t._s(t._f("decimal")(e.dPaidMoney)))])],1),t._v(" "),n("column-item",{staticClass:"text-right",attrs:{num:"10"}},[t._v("\n                    "+t._s(e.dProfitMoney>0?"+":"")),n("font",{staticClass:"font07"},[t._v(t._s(t._f("decimal")(e.dProfitMoney)))])],1)],1)],1)],1)}),t._v(" "),n("paginate",{attrs:{data:t.rankorderList},on:{pagedata:t.pagedata},slot:"paginate"}),t._v(" "),n("column",{staticClass:"color-warning",slot:"append"},[n("column-item",{attrs:{num:"25"}},[t._v("\n                 \n              ")]),t._v(" "),n("column-item",{attrs:{num:"15"}},[t._v("\n                "+t._s(t.totle.nShop)+"个门店\n              ")]),t._v(" "),n("column-item",{attrs:{num:"20"}},[t._v("\n                "+t._s(t.totle.nMember)+"个会员\n              ")]),t._v(" "),n("column-item",{staticClass:"text-right",attrs:{num:"10"}},[t._v("\n                "+t._s(t.totle.dTotleNumber>0?"+":"")+t._s(t._f("decimal")(t.totle.dTotleNumber))+"\n              ")]),t._v(" "),n("column-item",{staticClass:"text-right",attrs:{num:"10"}},[t._v("\n                "+t._s(t._f("decimal")(t.totle.dTotleSalePrice))+"\n              ")]),t._v(" "),n("column-item",{staticClass:"text-right",attrs:{num:"10"}},[t._v("\n                "+t._s(t.totle.dPaidMoney>0?"+":"")+t._s(t._f("decimal")(t.totle.dPaidMoney))+"\n              ")]),t._v(" "),n("column-item",{staticClass:"text-right",attrs:{num:"10"}},[t._v("\n                "+t._s(t.totle.dProfitMoney>0?"+":"")+t._s(t._f("decimal")(t.totle.dProfitMoney))+"\n              ")])],1)],2)],1),t._v(" "),n("popup",{attrs:{show:t.searchshow,ispadding:!0,type:"modal",title:t.$t("default.filter"),"close-button-text":t.$t("default.close"),direction:"fade-center"},on:{closeLsn:t.searchPopClose}},[n("column",{staticClass:"deuce"},[n("column-item",{attrs:{num:"50"}},[n("list",[n("list-item",[n("list-input",{attrs:{title:"门店"}},[n("select",{directives:[{name:"model",rawName:"v-model",value:t.ppshop,expression:"ppshop"}],on:{change:function(e){var n=Array.prototype.filter.call(e.target.options,function(t){return t.selected}).map(function(t){return"_value"in t?t._value:t.value});t.ppshop=e.target.multiple?n:n[0]}}},[n("option",{attrs:{value:"0"}},[t._v("全部门店")]),t._v(" "),t._l(t.shopList,function(e){return n("option",{key:e.id,domProps:{value:e.id}},[t._v(t._s(e.sName))])})],2)])],1)],1)],1),t._v(" "),n("column-item",{attrs:{num:"50"}},[n("list",[n("list-item",[n("list-input",{attrs:{title:"员工"}},[n("select",{directives:[{name:"model",rawName:"v-model",value:t.ppuser,expression:"ppuser"}],on:{change:function(e){var n=Array.prototype.filter.call(e.target.options,function(t){return t.selected}).map(function(t){return"_value"in t?t._value:t.value});t.ppuser=e.target.multiple?n:n[0]}}},[n("option",{attrs:{value:"0"}},[t._v("全部员工")]),t._v(" "),t._l(t.userList,function(e){return n("option",{key:e.id,domProps:{value:e.id}},[t._v(t._s(null!=e.sName?e.sName:e.sEmail))])})],2)])],1)],1)],1),t._v(" "),n("column-item",{attrs:{num:"50"}},[n("list",[n("list-item",[n("list-input",{attrs:{title:"会员"}},[t.memberList.length>0?n("select",{directives:[{name:"model",rawName:"v-model",value:t.ppmember,expression:"ppmember"}],on:{change:function(e){var n=Array.prototype.filter.call(e.target.options,function(t){return t.selected}).map(function(t){return"_value"in t?t._value:t.value});t.ppmember=e.target.multiple?n:n[0]}}},[n("option",{attrs:{value:"0"}},[t._v("全部会员")]),t._v(" "),t._l(t.memberList,function(e){return n("option",{key:e.id,domProps:{value:e.id}},[t._v(t._s(e.sSerial+(null!=e.sTag?"("+e.sTag+")":"")))])})],2):t._e()])],1)],1)],1),t._v(" "),n("column-item",{attrs:{num:"50"}},[n("list",[n("list-item",[n("list-input",{attrs:{title:"类型"}},[n("select",{directives:[{name:"model",rawName:"v-model.number",value:t.pptype,expression:"pptype",modifiers:{number:!0}}],on:{change:function(e){var n=Array.prototype.filter.call(e.target.options,function(t){return t.selected}).map(function(e){var n="_value"in e?e._value:e.value;return t._n(n)});t.pptype=e.target.multiple?n:n[0]}}},[n("option",{attrs:{value:"0"}},[t._v("全部")]),t._v(" "),t._l(t.$t("default.saletypes"),function(e,i){return n("option",{key:i,domProps:{value:i+1}},[t._v(t._s(e))])})],2)])],1)],1)],1),t._v(" "),n("column-item",{attrs:{num:"50"}},[n("list",[n("list-item",[n("list-input",{attrs:{title:"开始时间"}},[n("datetimer",{attrs:{time:t.ppstarttime,limit:[{type:"fromto",to:t.ppendtime}]},on:{changeLsn:t.ppstarttimechange}})],1)],1)],1)],1),t._v(" "),n("column-item",{attrs:{num:"50"}},[n("list",[n("list-item",[n("list-input",{attrs:{title:"截止时间"}},[n("datetimer",{attrs:{time:t.ppendtime,limit:[{type:"fromto",from:t.ppstarttime}]},on:{changeLsn:t.ppendtimechange}})],1)],1)],1)],1)],1),t._v(" "),n("br"),t._v(" "),n("column",{staticClass:"deuce"},[n("column-item",{attrs:{num:"50"}},[n("m-button",{attrs:{type:"danger"},nativeOn:{click:function(e){t.resetfilter()}}},[t._v("重置")])],1),t._v(" "),n("column-item",{attrs:{num:"50"}},[n("m-button",{nativeOn:{click:function(e){t.syncRankList()}}},[t._v("提交")])],1)],1)],1),t._v(" "),n("posts",{ref:"posts",on:{mounted:t.mountPost}})],1)},staticRenderFns:[]}},752:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n(180),r=n(177),o=n(179),s=n(178),a=n(190),l=n(186),u=n(192),c=n(187),p=n(223),m=n(217),d=n(224);e.default={components:{"page-header":i.Header,"header-link":i.HeaderLink,"header-title":i.HeaderTitle,"page-content":o.Content,"m-button":s.Button,"page-footer":a.Footer,Icon:r.Icon,Paginate:m.Paginate,Posts:l.Posts,List:c.List,ListItem:c.ListItem,ListInput:c.ListInput,Column:u.Column,ColumnItem:u.ColumnItem,ColumnSort:u.ColumnSort,Datetimer:p.Datetimer,Popup:d.Popup},computed:{totle:function(){for(var t=this.rankorderList,e=0,n=0,i=0,r=0,o=[],s=[],a=0,l=0;l<t.length;l++)o.indexOf(t[l].oShopID)<0&&o.push(t[l].oShopID),"0"!=t[l].oMemberID&&s.indexOf(t[l].oMemberID)<0&&s.push(t[l].oMemberID),t[l].nType<=2&&t[l].dMoney<=0&&(a+=t[l].dSurplusNumber),n+=t[l].dTotleSalePrice,e+=t[l].dTotleNumber,i+=t[l].dPaidMoney,r+=t[l].dProfitMoney;return{nShop:o.length,dSurplusNumber:a,nMember:s.length,dTotleNumber:e,dTotleSalePrice:n,dPaidMoney:i,dProfitMoney:r}},rankorderList:function(){var t=this;return this.rankList.keysort(this.sortkey,this.sortasc).filter(function(e){if(1!=e.nStatus)return!1;try{if(!e.sSerial){var n=t.getMember(e.oMemberID);e.sSerial=n.sSerial,e.sTag=n.sTag,e.sShopName=t.getShopName(e.oShopID)}}catch(t){}return!0})}},data:function(){return{sortasc:!0,sortkey:"nAddTime",searchshow:!1,searchInput:"",rankList:[],shopList:[],categoryList:[],memberList:[],userList:[],ppshop:this.$Cookie.get("cShopID",null),pptype:0,ppmember:"0",ppuser:"0",ppstarttime:"",ppendtime:"",pageDataList:[]}},methods:{pagedata:function(t){this.pageDataList=t},mountPost:function(){this.updateRoute()},searchPopClose:function(t){this.searchshow=!1},ppstarttimechange:function(t){this.ppstarttime=t},ppendtimechange:function(t){this.ppendtime=t},sortchange:function(t){this.sortkey=t.key,this.sortasc=t.asc},goback:function(t){var e=this;t?setTimeout(function(){e.$router.back()},1e3):e.$router.back()},updateRoute:function(){var t=this.$route.query;t.type?(this.pptype=t.type?t.type:0,this.ppmember=t.memberid?t.memberid:"0",this.ppstarttime="2017-01-01 00:00",this.ppendtime=this.$TimeUtils.now().add(1,"months").format("YYYY-MM-DD HH:mm"),this.ppshop="0",this.ppuser="0"):this.resetfilter(),this.syncRankList()},getShopName:function(t){var e=this.shopList;for(var n in e)if(e[n].id==t)return e[n].sName;return"未知"},getMember:function(t){var e=this.memberList;for(var n in e)if(e[n].id==t)return e[n];return"未知"},resetfilter:function(){this.ppstarttime=this.$TimeUtils.now().subtract(1,"months").format("YYYY-MM-DD HH:mm"),this.ppendtime=this.$TimeUtils.now().add(1,"months").format("YYYY-MM-DD HH:mm"),this.ppshop=this.$Cookie.get("cShopID",null),this.pptype=0,this.ppmember="0",this.ppuser="0"},syncRankList:function(){var t=this,e={oShopID:this.ppshop,nType:this.pptype,oMemberID:this.ppmember,oUserID:this.ppuser,nStartTime:this.$TimeUtils.formatDate(t.ppstarttime,"YYYY-MM-DD HH:mm").getTime(),nEndTime:this.$TimeUtils.formatDate(t.ppendtime,"YYYY-MM-DD HH:mm").getTime()};if(e.nStartTime>e.nEndTime)return void t.$refs.posts.toastError("开始时间不得大于截至时间！");t.$refs.posts&&t.$refs.posts.post(t.$Method.nSaleRecordList,e).then(function(e){t.$refs.posts.post(t.$Method.nShopList).then(function(n){t.$refs.posts.post(t.$Method.nMemberList).then(function(i){t.$refs.posts.post(t.$Method.nUserList).then(function(r){try{t.shopList=n.arrData.tables.shop.db}catch(e){t.shopList=[]}try{t.memberList=i.arrData.tables.member.db}catch(e){t.memberList=[]}try{t.userList=r.arrData.tables.user.db}catch(e){t.userList=[]}try{t.rankList=e.arrData.tables.salerecord.db}catch(e){t.rankList=[]}})})}),t.searchshow=!1})}},activated:function(){document.title=this.$t("admin.salerecord.title"),this.updateRoute()}}}});