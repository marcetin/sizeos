webpackJsonp([86],{224:function(e,t,n){var i=n(176)(n(226),null,null,null,null);e.exports=i.exports},226:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(e){return n.e(66).then(function(){var t=[n(241)];e.apply(null,t)}.bind(this)).catch(n.oe)};t.default={Popup:i}},267:function(e,t,n){var i=n(176)(n(690),n(471),null,null,null);e.exports=i.exports},471:function(e,t){e.exports={render:function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("popup",{attrs:{show:e.show,type:"modal",direction:"fade-center",title:e.title,"close-button-text":e.$t("default.close"),"left-button-text":e.$t("default.settle.lefttext")},on:{closeLsn:e.closeLsn,leftClick:e.goSettleLeft}},[n("page-content",{attrs:{ispadding:!0}},[n("vue-form",{attrs:{state:e.vstate},on:{submit:function(t){t.preventDefault(),e.confirmSettle()}}},[n("column",[n("column-item",{staticStyle:{"padding-right":"0.5rem"},attrs:{num:"60"}},[n("list",[n("column",{slot:"title"},[n("span",{staticClass:"pull-left"},[e._v("应收：￥"+e._s(e._f("decimal")(e.selectmember.id?e.memberprice:e.price))+" "),n("span",{directives:[{name:"show",rawName:"v-show",value:e.selectmember.id,expression:"selectmember.id"}],staticClass:"font06"},[e._v("(原价:"+e._s(e._f("decimal")(e.price))+")")])]),e._v(" "),n("span",{staticClass:"pull-right"},[e._v("找零：￥"+e._s(e._f("decimal")(e.changemoney)))])]),e._v(" "),e.selectmember.id?n("list-item",{attrs:{radio:!0,checktype:"border",hover:!1}},[n("icon",{attrs:{icon:"vipcard"}}),n("input",{directives:[{name:"model",rawName:"v-model",value:e.settlechecked,expression:"settlechecked"}],attrs:{type:"radio",name:"settle"},domProps:{value:{isMember:!0},checked:e._q(e.settlechecked,{isMember:!0})},on:{__c:function(t){e.settlechecked={isMember:!0}}}}),e._v(" "),n("list-input",{attrs:{title:"会员卡",titlestyle:"",isdanger:e.vstate.inputvip&&e.vstate.inputvip.$invalid,tip:""},on:{clearLsn:function(t){e.dPayMember=""}}},[n("validate",[n("input",{directives:[{name:"model",rawName:"v-model.number",value:e.dPayMember,expression:"dPayMember",modifiers:{number:!0}}],class:e.settlechecked.isMember?"is-active":"",attrs:{name:"inputvip",type:"text",placeholder:e.$t("default.settle.plsettlemoney"),required:"",pattern:"^\\d+(?:\\.\\d{1,2})?$"},domProps:{value:e.dPayMember},on:{click:function(t){e.settlechecked={isMember:!0}},input:function(t){t.target.composing||(e.dPayMember=e._n(t.target.value))},blur:function(t){e.$forceUpdate()}}})])],1)],1):e._e(),e._v(" "),n("column",e._l(e.moneyAccountList,function(t,i){return n("column-item",{key:i,attrs:{num:1==e.moneyAccountList.length?"100":"50"}},[n("list-item",{attrs:{radio:!0,checktype:"border",hover:!1}},[0==i?n("icon",{attrs:{icon:e.$t("default.accounticons")[0]}}):e._e(),e._v(" "),n("input",{directives:[{name:"model",rawName:"v-model",value:e.settlechecked,expression:"settlechecked"}],attrs:{type:"radio",name:"settle"},domProps:{value:t,checked:e._q(e.settlechecked,t)},on:{__c:function(n){e.settlechecked=t}}}),e._v(" "),n("list-input",{attrs:{title:t.sName,subtitle:"余额（"+t.dBalance+")",titlestyle:"",isdanger:e.vstate[t.id]&&e.vstate[t.id].$invalid},on:{clearLsn:function(e){t.money=""}}},[n("validate",[n("input",{directives:[{name:"model",rawName:"v-model.number",value:t.money,expression:"data.money",modifiers:{number:!0}}],class:e.settlechecked==t?"is-active":"",attrs:{name:t.id,type:"text",placeholder:e.$t("default.settle.plsettlemoney"),required:"",pattern:"^\\d+(?:\\.\\d{1,2})?$"},domProps:{value:t.money},on:{click:function(n){e.settlechecked=t},input:function(n){n.target.composing||(t.money=e._n(n.target.value))},blur:function(t){e.$forceUpdate()}}})])],1)],1)],1)})),e._v(" "),n("column",e._l(e.bankAccountList,function(t,i){return n("column-item",{key:i,attrs:{num:1==e.bankAccountList.length?"100":"50"}},[n("list-item",{attrs:{radio:!0,checktype:"border",hover:!1}},[0==i?n("icon",{attrs:{icon:e.$t("default.accounticons")[1]}}):e._e(),e._v(" "),n("input",{directives:[{name:"model",rawName:"v-model",value:e.settlechecked,expression:"settlechecked"}],attrs:{type:"radio",name:"settle"},domProps:{value:t,checked:e._q(e.settlechecked,t)},on:{__c:function(n){e.settlechecked=t}}}),e._v(" "),n("list-input",{attrs:{title:t.sName,subtitle:"余额（"+t.dBalance+")",titlestyle:"",tip:"",isdanger:e.vstate[t.id]&&e.vstate[t.id].$invalid},on:{clearLsn:function(e){t.money=""}}},[n("validate",[n("input",{directives:[{name:"model",rawName:"v-model.number",value:t.money,expression:"data.money",modifiers:{number:!0}}],class:e.settlechecked==t?"is-active":"",attrs:{name:t.id,type:"text",placeholder:e.$t("default.settle.plsettlemoney"),required:"",pattern:"^\\d+(?:\\.\\d{1,2})?$"},domProps:{value:t.money},on:{click:function(n){e.settlechecked=t},input:function(n){n.target.composing||(t.money=e._n(n.target.value))},blur:function(t){e.$forceUpdate()}}})])],1)],1)],1)})),e._v(" "),n("column",e._l(e.thirdAccountList,function(t,i){return n("column-item",{key:i,attrs:{num:1==e.thirdAccountList.length?"100":"50"}},[n("list-item",{attrs:{radio:!0,checktype:"border",hover:!1}},[0==i?n("icon",{attrs:{icon:e.$t("default.accounticons")[2]}}):e._e(),e._v(" "),n("input",{directives:[{name:"model",rawName:"v-model",value:e.settlechecked,expression:"settlechecked"}],attrs:{type:"radio",name:"settle"},domProps:{value:t,checked:e._q(e.settlechecked,t)},on:{__c:function(n){e.settlechecked=t}}}),e._v(" "),n("list-input",{attrs:{title:t.sName,subtitle:"余额（"+t.dBalance+")",titlestyle:"",tip:"",isdanger:e.vstate[t.id]&&e.vstate[t.id].$invalid},on:{clearLsn:function(e){t.money=""}}},[n("validate",[n("input",{directives:[{name:"model",rawName:"v-model.number",value:t.money,expression:"data.money",modifiers:{number:!0}}],class:e.settlechecked==t?"is-active":"",attrs:{name:t.id,type:"text",placeholder:e.$t("default.settle.plsettlemoney"),required:"",pattern:"^\\d+(?:\\.\\d{1,2})?$"},domProps:{value:t.money},on:{click:function(n){e.settlechecked=t},input:function(n){n.target.composing||(t.money=e._n(n.target.value))},blur:function(t){e.$forceUpdate()}}})])],1)],1)],1)})),e._v(" "),n("column",e._l(e.couponAccountList,function(t,i){return n("column-item",{key:i,attrs:{num:1==e.couponAccountList.length?"100":"50"}},[n("list-item",{attrs:{radio:!0,checktype:"border",hover:!1}},[0==i?n("icon",{attrs:{icon:e.$t("default.accounticons")[3]}}):e._e(),e._v(" "),n("input",{directives:[{name:"model",rawName:"v-model",value:e.settlechecked,expression:"settlechecked"}],attrs:{type:"radio",name:"settle"},domProps:{value:t,checked:e._q(e.settlechecked,t)},on:{__c:function(n){e.settlechecked=t}}}),e._v(" "),n("list-input",{attrs:{title:t.sName,subtitle:"余额（"+t.dBalance+")",titlestyle:"",tip:"",isdanger:e.vstate[t.id]&&e.vstate[t.id].$invalid},on:{clearLsn:function(e){t.money=""}}},[n("validate",[n("input",{directives:[{name:"model",rawName:"v-model.number",value:t.money,expression:"data.money",modifiers:{number:!0}}],class:e.settlechecked==t?"is-active":"",attrs:{name:t.id,type:"text",placeholder:e.$t("default.settle.plsettlemoney"),required:"",pattern:"^\\d+(?:\\.\\d{1,2})?$"},domProps:{value:t.money},on:{click:function(n){e.settlechecked=t},input:function(n){n.target.composing||(t.money=e._n(n.target.value))},blur:function(t){e.$forceUpdate()}}})])],1)],1)],1)}))],1)],1),e._v(" "),n("column-item",{attrs:{num:"40"}},[n("column",{staticClass:"deuce",attrs:{gutter:!0}},[e._l(e.QuilkReceipts,function(t,i){return n("column-item",{key:i,staticStyle:{padding:"0.2rem"},attrs:{num:"25"},nativeOn:{click:function(n){e.quickNumber(t)}}},[n("m-button",{staticStyle:{width:"100%"},attrs:{type:"green",size:"small"}},[e._v(e._s(t))])],1)}),e._v(" "),n("div",{staticStyle:{clear:"both"}}),e._v(" "),e._l(e.calculates,function(t,i){return n("column-item",{key:i,staticStyle:{padding:"0.2rem"},attrs:{num:"25"},nativeOn:{click:function(n){e.calculate(t)}}},[n("m-button",{staticStyle:{width:"100%"},attrs:{type:"light",size:"small"}},[e._v(e._s(t))])],1)}),e._v(" "),n("column-item",{directives:[{name:"show",rawName:"v-show",value:e.selectmember.id,expression:"selectmember.id"}],staticStyle:{padding:"0.2rem"},attrs:{num:"100"}},[n("span",{staticClass:"font07 color-light "},[e._v("会员:"+e._s(e.selectmember.id?e.selectmember.sName:""))]),e._v(" "),n("span",{staticClass:"font07 pull-right color-warning "},[e._v("会员余额:"+e._s(e._f("decimal")(e.selectmember.dBalance)))])]),e._v(" "),n("column-item",{staticStyle:{padding:"0.2rem"},attrs:{num:"50"}},[n("m-button",{staticStyle:{width:"100%"},attrs:{type:"danger",size:"small"},nativeOn:{click:function(t){e.closeLsn()}}},[e._v(e._s(e.$t("default.cancel")))])],1),e._v(" "),n("column-item",{staticStyle:{padding:"0.2rem"},attrs:{num:"50"}},[n("m-button",{staticStyle:{width:"100%"},attrs:{disabled:e.vstate.$invalid||e.changemoney<0,size:"small"},nativeOn:{click:function(t){e.vstate.$invalid||e.changemoney<0||e.confirmSettle()}}},[e._v(e._s(e.$t("default.confirm")))])],1)],2)],1)],1)],1),e._v(" "),n("posts",{ref:"posts"})],1)],1)},staticRenderFns:[]}},690:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(192),c=n(179),s=n(177),o=n(187),a=n(178),l=n(186),r=n(224);t.default={components:{"page-content":c.Content,Column:i.Column,ColumnItem:i.ColumnItem,Icon:s.Icon,Popup:r.Popup,"m-button":a.Button,List:o.List,ListItem:o.ListItem,ListInput:o.ListInput,Posts:l.Posts},props:{show:{type:Boolean,default:!1},title:{type:String,default:"Popup Title"},selectmember:{type:Object,default:function(){return{}}},memberprice:{type:Number,default:0},price:{type:Number,default:0}},watch:{dPayMember:function(e,t){e!=t&&this.selectmember.id&&this.selectmember.dBalance<this.parseMoney(e)&&(this.dPayMember=(this.selectmember.dBalance<this.memberprice?this.selectmember.dBalance:this.memberprice).toDecimal(2))},show:function(e,t){e&&this.showSettlePop()}},data:function(){return{moneyAccountList:[],bankAccountList:[],thirdAccountList:[],couponAccountList:[],settlechecked:{},QuilkReceipts:[],calculates:["1","2","3","4","5","6","7","8","9","0","←","."],dPayMember:0,vstate:{}}},computed:{totlemoney:function(){for(var e=0,t=0;t<this.moneyAccountList.length;t++)try{e+=this.parseMoney(this.moneyAccountList[t].money)}catch(e){console.error(e)}for(var t=0;t<this.bankAccountList.length;t++)try{e+=this.parseMoney(this.bankAccountList[t].money)}catch(e){console.error(e)}for(var t=0;t<this.thirdAccountList.length;t++)try{e+=this.parseMoney(this.thirdAccountList[t].money)}catch(e){console.error(e)}for(var t=0;t<this.couponAccountList.length;t++)try{e+=this.parseMoney(this.couponAccountList[t].money)}catch(e){console.error(e)}return(this.dPayMember+e).toDecimal(2)},changemoney:function(){return(this.totlemoney-this.parseMoney(this.selectmember.id?this.memberprice:this.price)).toDecimal(2)}},methods:{closeLsn:function(){this.$emit("closeLsn")},parseMoney:function(e){return e=parseFloat(e),isNaN(e)&&(e=0),e},deleteLastStr:function(e){return e+="",e.substr(0,e.length-1)},calcul:function(e,t){if(t+="","."==e){if(0==t.length||-1!=t.indexOf("."))return t}else if("←"==e)return this.deleteLastStr(t);return t+=e},calculate:function(e){this.settlechecked.isMember?this.dPayMember=this.calcul(e,this.dPayMember):this.settlechecked.money=this.calcul(e,this.settlechecked.money)},quickNumber:function(e){this.settlechecked.isMember?this.dPayMember=e:this.settlechecked.money=e},confirmSettle:function(){var e=this;e.vstate.$valid&&e.changemoney>=0&&e.$emit("settleAccount",{accountData:{oMemberID:e.selectmember.id?e.selectmember.id:null,dPayMember:e.dPayMember.toDecimal(2),dChange:e.changemoney.toDecimal(2),moneyAccountList:e.moneyAccountList,bankAccountList:e.bankAccountList,thirdAccountList:e.thirdAccountList,couponAccountList:e.couponAccountList}})},goSettleLeft:function(){this.$router.push({path:"admin_account_manage"})},showSettlePop:function(){var e=this,t=this.selectmember.id?this.memberprice:this.price,n=Math.ceil(t),i=t%10<=5?t-t%10+5:t-t%10+10,c=t-t%10+10,s=t<=50||t/10%10<=5?t-t%100+50:t-t%100+100,o=t-t%100+100,a=[];a.push(t),a.indexOf(n)<0&&a.push(n),a.indexOf(c)<0&&a.push(c),a.indexOf(s)<0&&a.push(s),a.indexOf(o)<0&&a.push(o),a.length<4&&a.indexOf(i)<0&&a.push(i),this.QuilkReceipts=a.slice(0,4);var l=0;this.dPayMember=0,this.settlechecked={},this.selectmember.id?(l=0,this.dPayMember=t,this.settlechecked={isMember:!0}):(l=t,this.dPayMember=0);var r=!1;e.$refs.posts.post(e.$Method.nAccountList).then(function(t){e.moneyAccountList=[],e.bankAccountList=[],e.thirdAccountList=[],e.couponAccountList=[];try{for(var n=t.arrData.tables.account.db,i=0;i<n.length;i++){var c=n[i];1==c.nStatus&&(c.money=0,1==c.nType?(0==l||r||(r=!0,c.money=l,e.settlechecked.isMember||(e.settlechecked=c)),e.moneyAccountList.push(c)):2==c.nType?e.bankAccountList.push(c):3==c.nType?e.thirdAccountList.push(c):4==c.nType&&e.couponAccountList.push(c))}e.showSettle=!0}catch(e){}e.moneyAccountList.length+e.bankAccountList.length+e.thirdAccountList.length+e.couponAccountList.length<=0&&(e.$refs.posts.toastError("请先添加帐户！"),setTimeout(function(){e.goSettleLeft()},1e3))})}}}}});